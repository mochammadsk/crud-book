name: Express MongoDB CI/CD

on:
  push:
    branches:
      - main

  pull_request:
    branches:
      - main

env:
  MONGODB_URI: 'mongodb://localhost:27017/crud'
  NODE_ENV: 'production'
  PORT: 3000

jobs:
  test:
    runs-on: ubuntu-latest

  strategy:
    matrix:
      node-version: [20.12.0]
      mongodb-version: [1.44.6]

  steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install dependencies
      run: npm install

    - name: Run tests
      run: npm test

    - name: Build the application
      run: npm run build

  deploy:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Deploy to Production
        run: |
          echo "Deploying to production server..."
          # Tambahkan skrip untuk proses deploy Anda, misalnya menggunakan SSH, Docker, atau layanan cloud
